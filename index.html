<!DOCTYPE html>
<meta charset="utf-8">
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
<link rel="stylesheet" type="text/css" href="style.css">
<h2>Median Age in Asia (2024)</h2>
<h3>Proof of concept</h3>
<p>Code revised from: <a href="https://d3-graph-gallery.com/graph/choropleth_basic.html" target="_blank">https://d3-graph-gallery.com/graph/choropleth_basic.html</a></p>

<svg id="median_age" width="1000" height="800"></svg>

<script>
const svg = d3.select("#median_age")

const width = svg.attr("width");
const height = svg.attr("height");

const projection = d3.geoMercator()
      .scale(250)
      .center([90, 50])
      .translate([width / 2, height / 2]);

const path = d3.geoPath().projection(projection);

let data = d3.map();
const colorScale = d3.scaleThreshold()
      .domain([20, 25, 30, 35, 40, 45, 50])
      // yellow --> red gradient
      .range(["#ffffcc", "#ffeda0", "#feb24c", "#fd8d3c", "#fc4e2a", "#e31a1c"]);
      // .range(d3.schemeBlues[7])
      // .range(d3.schemeOranges[7])

d3.csv("project-data.csv", function(d) {
  d["Med. Age"] = +d["Med. Age"].replace(/[^\d.-]/g, '');
  data.set(d["Country (or dependency)"], d["Med. Age"]);
}, function(error, rows) {
  if (error) throw error;

  d3.json("updated_world.geojson", function(error, world) {
    if (error) throw error;
    
    let asiaCountriesList = [
      "Afghanistan", "Armenia", "Azerbaijan", "Bangladesh",
      "Bhutan", "Brunei", "Cambodia", "China", "Cyprus", "Georgia",
      "India", "Indonesia", "Iran", "Iraq", "Israel", "Japan", "Jordan",
      "Kazakhstan", "Kuwait", "Kyrgyzstan", "Laos", "Lebanon", "Malaysia",
      "Mongolia", "Myanmar", "Nepal", "North Korea", "Oman",
      "Pakistan", "Palestine", "Philippines", "Qatar", "Russia", "Saudi Arabia",
      "South Korea", "Sri Lanka", "Syria", "Taiwan", "Tajikistan",
      "Thailand", "Timor-Leste", "Turkey", "Turkmenistan", "United Arab Emirates",
      "Uzbekistan", "Vietnam", "Yemen", "Singapore", "Bahrain", "Maldives"
    ];

    let asiaCountries = world.features.filter(function(d) {
      return asiaCountriesList.includes(d.properties.name);
    });

    const median_country_fill = d => {
      const medianAge = data.get(d.properties.name);
      if (medianAge) {
        return colorScale(medianAge);
      } else {
        return "#ccc";
    }};

    svg.append("g")
      .selectAll("path")
      .data(asiaCountries)
      .enter()
      .append("path")
      .attr("class", "country")
      .attr("d", path)
      .attr("fill", d => {
        const medianAge = data.get(d.properties.name);
        console.log("Processing country:", d.properties.name, "Median Age:", medianAge ? medianAge : 'No data');
        return median_country_fill(d);
      });

    let legend = svg.append("g")
      .attr("transform", "translate(20,20)");

    const legendData = [20, 25, 30, 35, 40, 45, 50];
    const legendItemHeight = 20;
       
    const yLegend = ((d, i) => i * legendItemHeight);

    legend.selectAll("rect")
      .data(legendData)
      .enter()
      .append("rect")
      .attr("x", 0)
      .attr("y", yLegend)
      .attr("width", 20)
      .attr("height", 20)
      .attr("fill", d => colorScale(d));

    legend.selectAll("text")
      .data(legendData)
      .enter()
      .append("text")
      .attr("x", 30)
      .attr("y", (d, i) => i * legendItemHeight + 15)
      .text(d => `${d} years`);

    });
  });
</script>

<br>
<br>

<p>Variables Used:</p>
<ul>
  <li>Country (or dependency): The name of the country.</li>
  <li>Med. Age: The median age of the population in each country.</li>
</ul>

<p>Note:</p>
<ul>
  <li>asia.geojson shows us a different map, but only has 46 countries</li>
  <li>world.geojson has all countries needed</li>
</ul>
